#!/bin/bash

#              ,---------------------------,
#              |  /---------------------\  |
#              | |                       | |
#              | |     Jack Nemitz       | |
#              | |      .dotfiles        | |
#              | |  functions_template   | |
#              | |                       | |
#              |  \_____________________/  |
#              |___________________________|
#            ,---\_____     []     _______/------,
#          /         /______________\           /|
#        /___________________________________ /  | ___
#        |                                   |   |    )
#        |  _ _ _                 [-------]  |   |   (
#        |  o o o                 [-------]  |  /    _)_
#        |__________________________________ |/     /  /
#    /-------------------------------------/|      ( )/
#  /-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/ /
#/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/ /
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

'''
This template is built off of the .funcitons setup that I use.
Due to personal information confidentiality, I made a template rather than publishing my personal configurations.
Some areas of this template have been redacted for this reason. I have put comments where you will need to provide your own information for these funcitons to work properly.
'''

###############################################
################# File System #################
###############################################

# Create a new directory and enter it
function mkd() {
  mkdir -p "$@" && cd "$_";
}

# Copy current working directory (adding arg 1 will copy path to that file)
function thispath(){
  help="thispath
         A utility to copy a path to the system clipboard

         USAGE:
           thispath
           thispath [OPTION]

         OPTIONS:
           -d, --directory        Make directories selectable
           -f, --file             Make directories traversable (only files are selectable)
  "
  if [ $# -eq 1 ]
    then
      wd=`pwd`;
      case $1 in
        -d|--directory)
          dir=$(gum file -a --directory);
          command echo "${wd}/${dir}" | pbcopy;
          ;;
        -f|--file)
          file=$(gum file -a);
          command echo "${wd}/${file}" | pbcopy;
          ;;
        -*|--*)
          echo "Unknown option $1"
          ;;
      esac
  elif [ $# -gt 1 ]
    then
      while [[ $# -gt 0 ]]; do
        echo "Unknown option: $1";
        shift
      done
  else
    command pwd | pbcopy;
  fi;
}

function symlink() {
  gum style \
	--foreground 212 --border-foreground 212 --border double \
	--align center --width 50 --margin "0 1" --padding "0 1" \
	'Select file to create a link...';
  file=$(gum file -a);
  echo "Creating link to $file...";
  gum style \
	--foreground 212 --border-foreground 212 --border double \
	--align center --width 50 --margin "0 1" --padding "0 1" \
	'Path to new link...';
  link=$(gum input --placeholder "$(pwd)/...");
  echo "Linking to $link...";
  gum confirm && (ln -s ./$file ./$link && echo "Created link $link -> $file") || echo "Cancelled symlink...";
}

function removePath() { 
  export PATH="$( echo $PATH| tr : '\n' |grep -v $1 | paste -s -d: )"
}

###############################################
################ Git Functions ################
###############################################

# Auto commit/push
function gitit() {
  command git status;
  command git add .;
  command git commit -m "auto commit";
  command git push;
};

# List branches and prompt to switch to a branch
function check() {
  branches=();
  count=0;
  for branch in $(git for-each-ref refs/heads  | cut -d/ -f3-); do
    (( count++ ))
    branches+=($branch)
  done
  gum style \
    --foreground 153 --border-foreground 182 --border double \
    --align center --width 50 --margin "0 1" --padding "0 1" \
    'Git Checkout...'
  choise=$(gum choose "${branches[@]}");
  git checkout ${choise};
};

function git_comm() {
  type=$(gum choose --cursor.foreground 182  "add" "implement" "update" "fix" "bug" "remove" "feat" "refactor" "docs" "other");
  if [ "$type" == "other" ]; then
    type=$(gum input --placeholder "Enter a custom commit type...");
  fi;
  gum style \
    --foreground 182 --border-foreground 182 --border rounded \
    --align center --width 25 --margin "0 0" --padding "0 0" \
    "Commit";
  title=$(gum input --width 72 --char-limit 72 --value "$type: ");
  gum style \
    --foreground 153 --border none \
    --align left --width 50 --margin "1 0 1 1" --padding "0 0" \
    "$title";
  what=$'|What:\n';
  gum style \
    --foreground 153 --border none \
    --align left --width 50 --margin "0 0 1 2" --padding "0 1" \
    "|What: ";
  inp=' ';
  while [ "$inp" != '' ]
  do 
    inp=$(gum input --prompt "     - " --placeholder "WHAT functionally changed or press enter to submit");
    if [ "$inp" != '' ]; then
      gum style \
        --foreground 153 --border none \
        --align left --width 50 --margin "0 0 0 2" --padding "0 1" \
        "  • $inp";
      what="$what"$'\n  - '"$inp";
    fi;
  done;
  why=$'|Why:\n';
  gum style \
    --foreground 153 --border none \
    --align left --width 50 --margin "1 0 1 2" --padding "0 1" \
    "|Why: ";
  inp=' ';
  while [ "$inp" != '' ]
  do 
    inp=$(gum input --prompt "     - " --placeholder "WHY the change was made or press enter to submit");
    if [ "$inp" != '' ]; then
      gum style \
        --foreground 153 --border none \
        --align left --width 50 --margin "0 0 0 2" --padding "0 1" \
        "  • $inp";
      why="$why"$'\n  - '"$inp";
    fi;
  done;
  next=$'|Next:\n';
  gum style \
    --foreground 153 --border none \
    --align left --width 50 --margin "1 0 1 2" --padding "0 1" \
    "|Next: ";
  inp=' ';
  while [ "$inp" != '' ]
  do 
    inp=$(gum input --prompt "     - " --placeholder "NEXT steps to take or press enter to submit");
    if [ "$inp" != '' ]; then
      gum style \
        --foreground 153 --border none \
        --align left --width 50 --margin "0 0 0 2" --padding "0 1" \
        "  • $inp";
      next="$next"$'\n  - '"$inp";
    fi;
  done;
  echo "$title" > commit.tmp;
  # count numbe of characters in variable..
  if [ ${#what} -ne 7 ]; then
    echo $'\n'"$what" >> commit.tmp;
  fi;
  if [ ${#why} -ne 6 ]; then
    echo $'\n'"$why" >> commit.tmp;
  fi;
  if [ ${#next} -ne 7 ]; then
    echo $'\n'"$next" >> commit.tmp;
  fi;
  until gum confirm --affirmative "Commit" --negative "Edit" --selected.background 110 "Commit changes?"; ss=$?; [[ $ss -eq 0 ]]
  do
    nvim commit.tmp;
  done;
  git commit -F commit.tmp;
  rm commit.tmp;
};
###############################################
################ SSH Functions ################
###############################################

###############################################
################ Gen Functions ################
###############################################

function goodnight() {
    command sudo tmutil stopbackup;
    for v in /Volumes/*; do
    if [[ $v != *"Macintosh HD" && $v != *"Recovery"* && $v != "pi" ]]; then
      echo "Unmounting $v..."
      command diskutil unmount "/$v";
      echo
    fi;
    done
    count=10;
    while [[ count -gt 0 ]]; do
      count=$((count-1));
      echo "Computer will sleep in: ${count}";
      command sleep 1;
    done
    command pmset sleepnow;
};

